REM : Skrypt wklajmy w putty po połączeniu z drukarką (115200,8,1,none)
REM : W drukarce wczesniej nalezy włączyc virtualny port COM
REM :

DELETE1-100000
IMMEDIATE OFF

KEY (10) ON
KEY (11) ON
KEY (12) ON
KEY (13) ON
KEY (14) ON
KEY (16) ON
KEY (17) ON
KEY (20) ON

COMSET9,"","","",CHR$(10),7
COMSET 9 ON

ON KEY (10) GOSUB SUBHOME
ON KEY (12) GOSUB SUBUP
ON KEY (14) GOSUB SUBDOWN
ON KEY (11) GOSUB SUBLEFT
ON KEY (13) GOSUB SUBRIGHT
ON KEY (16) GOSUB SUBENTER
ON KEY (20) GOSUB SUBBACK
ON KEY (17) GOSUB SUBPAPER
ON ERROR GOTO SUBERROR
ON COMSET 9 GOSUB MAINLOOP

OPEN "console:" FOR OUTPUT AS 1

BREAK 0 OFF
SYSVAR(18)=-1
NASC 8

A$="10"
C$=A$
B%=0
LTS& ON

'SETSTDIO 9,0

'PRINT "Start programu"
TESTFEED

SUBSTART:
'czyszczenie ekranu
PRINT #1, CHR$(155) + "2J"
PRINT #1, "Cena: ";C$

SUBREAD: IF A$ <> "STOP" THEN GOTO SUBREAD

MAINLOOP:
I%=0
L%=1

SUBECHO:
B$=INKEY$
PRINT B$
IF B$ <> CHR$(10) THEN PRINT #1, B$ : GOTO SUBECHO

A$=COMBUF$(9)

IF A$<>"" THEN C$=A$

T$="ARRAY$"
DIM ARRAY$(1)
I%=SPLIT(A$,T$,42)

IF I%=2 THEN 
L%=VAL(ARRAY$(0))
C$=ARRAY$(1)
ELSE 
L%=1 
ENDIF

'czyszczenie ekranu
PRINT #1, CHR$(155) + "2J"
PRINT #1, "Cena: ";C$

'PRINT I%;" | ";A$;" | ";C$

PRPOS 10,160
FONT "Univers",7
PRTXT "Dyskont TANIA ODZIEŻ"

PRPOS 10,60
FONT "Univers Bold",30,0,75
PRTXT C$;" zł"

PRPOS 10,35
FORMAT DATE$ "YYYY-MM-DD"
FORMAT TIME$ "HH:MM:SS" 
FONT "Univers",7
PRTXT "Data: ";DATE$("F");" ";TIME$("F") 

PRPOS 10,10
FONT "Univers",7
PRTXT "Stanowisko 1"

B%=ASC(C$)
IF B%<>47 THEN PRINTFEED L%
'IF B%<>47 THEN PRINT "DRUKOWANIE";L%;B%
COMSET 9 ON
RETURN

SUBHOME: 
PRINT "HOME"
RETURN


SUBUP: 
PRINT "UP UP"
RETURN

SUBDOWN: 
PRINT "DOWN"
RETURN

SUBLEFT: 
PRINT "LEFT"
RETURN

SUBRIGHT: 
PRINT "RIGHT"
RETURN

SUBENTER: 
TESTFEED
RETURN

SUBBACK: 
PRINT "Bye"
LTS& OFF
CLOSE
SETSTDIO 100
END
SUBPAPER:
IF PRSTAT<7 THEN 
PRINT "JEST OK"
PRINT PRSTAT
FORMFEED
RETURN
ELSE 
PRINT #1, CHR$(155) + "2J"
PRINT #1, "Sprawdz papier"
PRINT #1, "===============";
PRINT PRSTAT
RETURN
ENDIF
'czyszczenie ekranu
PRINT #1, CHR$(155) + "2J"
PRINT #1, "Cena: ";C$
RETURN

SUBERROR:
9500 PRINT "OBSL BLEDU";ERR
9530 IF ERR=1005 OR ERR=1031 THEN
9531 PRINT #1, CHR$(155) + "2J"
9532 PRINT #1, "Sprawdz papier"
9533 PRINT #1, "===============";
9550 IF (PRSTAT AND 1)=0 THEN 
9560 PRINT PRSTAT : PRINT ERR
9561 GOTO 9670
9562 ELSE 
9565 GOTO 9550
9568 ENDIF 
9570 GOTO 9670
9580 ENDIF
9631 PRINT #1, CHR$(155) + "2J"
9632 PRINT #1, "Blad ";ERR
9633 PRINT #1, "===============";
9670 RESUME NEXT

IMMEDIATE ON
RUN

SAVE "tmp:ETYKIETA.PRG",L

SYSVAR(43)=1
COPY "/tmp/ETYKIETA.PRG","/c/scripts/ETYKIETA.PRG"
COPY "/tmp/ETYKIETA.PRG","/c/ETYKIETA.PRG"
OPEN "AUTOEXEC.BAT" FOR OUTPUT AS 1
PRINT#1,"RUN";CHR$(34);"ETYKIETA.PRG";CHR$(34)
CLOSE1

REBOOT

REM :## Czyszczenie pliku autostartu
REM :OPEN "AUTOEXEC.BAT" FOR OUTPUT AS 1
REM :PRINT#1,""
REM :CLOSE1





